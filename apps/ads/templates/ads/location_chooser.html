{% extends 'navbar.html' %}
{% load widget_tweaks %}
{% block title %}Choose location{% endblock %}
{% load static %}
{% load staticfiles %}

{% block ads_active %}
active
{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static 'ads/location_chooser.css' %}">
    <link rel="stylesheet" href="{% static 'css/indeterminate_progress.css' %}">
    <link rel="stylesheet" href="{% static 'css/bootstrap-multiselect.css' %}">
{% endblock %}

{% block script %}
    <script>
        $('document').ready(function(){
            var state="";
            var appendedDistrict=false,appendedState=false;
            $.getJSON('/api/locations').done(function(data1){
                $.each(data1.values,function(id,value){
                    var option = document.createElement('option');
                    option.innerHTML=value;
                    option.value=value;
                    $('#stateInput').append(option);
                });
                $('#stateInput').multiselect({
                    onChange: function(option, checked, select){
                        $('#stateInput').css({'dispay':'none'});
                        $('.progress').css({'display':'block'});
                        state=$(option).val();
                        $.getJSON('/api/locations',{'state':state})
                        .done(function(data2){
                            $.each(data2.values,function(id,value){
                                var option = document.createElement('option');
                                option.innerHTML=value;
                                option.value=value;
                                $('#districtInput').append(option);
                            });
                            $('#districtInput').multiselect({
                                onChange: function(option, checked, select){
                                    $('#districtInput').multiselect('destroy');
                                    $('.progress').css({'display':'block'});
                                    var district = $(option).val();
                                    var url = "{% url 'ads:list' state='state' district='district' %}";
                                    window.location.href=url.replace('state',state).replace('district',district);
                                },
                                enableHTML: false,
                                enableCaseInsensitiveFiltering: true,
                                maxHeight: 300,
                                noneSelectedText: 'Choose District',
                                buttonWidth: '300px',
                                onInitialized: function(select, container){
                                    $('#stateInput').multiselect('destroy');
                                    $('.progress').css({'display':'none'});
                                    $('#districtInput').css({'display':'block'});
                                    $('.multiselect-search').removeClass('form-control');
                                    var i=document.createElement('i');
                                    i.className='fa fa-times-circle multiselect-clear-filter';
                                    $('.input-group-btn').append(i);
                                    $('.glyphicon.glyphicon-search').addClass('fa fa-search');
                                    appendedDistrict=true;
                                }
                            });
                        });
                    },
                    enableHTML: false,
                    enableCaseInsensitiveFiltering: true,
                    maxHeight: 300,
                    nonSelectedText: 'Choose State',
                    buttonWidth: '300px',
                    onInitialized: function(select, container){
                        $('.progress').css({'display':'none'});
                        $('#stateInput').css({'display':'block'});
                        $('.multiselect-search').removeClass('form-control');
                        var i=document.createElement('i');
                        i.className='fa fa-times-circle multiselect-clear-filter';
                        $('.input-group-btn').append(i);
                        $('.glyphicon.glyphicon-search').addClass('fa fa-search');
                    }
                });
            });
        });
    </script>
    <script src="{% static 'js/bootstrap-multiselect.js' %}"></script>
{% endblock %}

{% block content %}

    <div class="container-fluid col-10 d-flex justify-content-center">
        <div class="sub-container">
        
            <div class="mt-5" id="location">

                <select id="stateInput">
                </select>

                <div class="progress">
                    <div class="progress-bar progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                        <span>Please wait<span class="dotdotdot"></span></span>
                    </div>
                </div>

                <select id="districtInput">
                </select>
                
            </div>

        </div>
        
    </div>
    
{% endblock %}
